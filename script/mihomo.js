// 链式代理节点处理脚本

/**
 * @description 终极整合脚本：
 * 1. 对节点进行预处理（例如，为落地节点添加 dialer-proxy）。
 * 2. 将处理后的节点与你自己的远程分流规则模板进行合并。
 * @author xymhh
 */
function main(params) {
    // ------------------------------------------------------------------
    // 第一步：节点预处理（你提供的脚本逻辑）
    // ------------------------------------------------------------------
    // 我们直接在 params.proxies 上进行操作。
    // forEach 是一个简洁的遍历方式。
    params.proxies.forEach(p => {
        if (p.name.includes("落地")) {
            p['dialer-proxy'] = "智能中转";
        }
    });

    // ------------------------------------------------------------------
    // 第二步：合并远程规则（核心步骤）
    // ------------------------------------------------------------------

    const ruleUrl = "";
    utils.profile.patch(ruleUrl);

    // ------------------------------------------------------------------
    // 第三步：返回最终结果
    // ------------------------------------------------------------------
    return params;
}